# Releases the plugin to GitHub and VS Code Marketplace
name: Release
on:
  release:
    types: [released]

jobs:
    build:
        name: Build
        uses: ./.github/workflows/build.yml
        secrets: inherit
        with:
          version: ${{ github.event.release.tag_name }}

    release:
        name: Release
        runs-on: ubuntu-latest
        needs: build
        steps:
            - name: Download VSIX from Cache
              uses: actions/cache@v2
              with:
                  path: ./*.vsix
                  key: scorpio-${{ github.event.release.tag_name }}.vsix

            # release to VS Code Marketplace

            # Upload artifact as a release asset
            - name: Upload Release Asset
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: gh release upload ${{ github.event.release.tag_name }} ./*.vsix
